# SliTaz package receipt.

PACKAGE="opentyrian-classic"
VERSION="r886"
CATEGORY="games"
SHORT_DESC="OpenTyrian is a port of the DOS shoot-em-up Tyrian"
MAINTAINER="mallory@skyrock.com"
DEPENDS="libsdl libsdl-mixer  libsdl-net"
BUILD_DEPENDS="libsdl-dev libsdl-mixer-dev libsdl-net-dev mercurial"
SOURCE="opentyrian"
WEB_SITE="http://code.google.com/p/opentyrian/"
WGET_URL=""

. /etc/tazwok.conf
# Rules to configure and make the package.
compile_rules()
{
	TARBALL=$SOURCES_REPOSITORY/$PACKAGE.tar.gz
	if [ -f $TARBALL ]; then
		tar xzf $TARBALL
	else
		hg clone https://opentyrian.googlecode.com/hg/ opentyrian  
		tar czf $TARBALL opentyrian
	if
	cd $SOURCE
	make release
	[ -f $SOURCES_REPOSITORY/tyrian21.zip ] ||
	wget http://camanis.net/tyrian/tyrian21.zip -P $SOURCES_REPOSITORY
	unzip $SOURCES_REPOSITORY/tyrian21.zip
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p $fs/usr/bin
	mkdir -p $fs/usr/share/applications
	mkdir -p $fs/usr/share/pixmaps
	mkdir -p $fs/usr/share/opentyrian
	cp $SOURCE/tyrian $fs/usr/share/opentyrian
	cp $SOURCE/opentyrian.desktop $fs/usr/share/applications
	cp $SOURCE/tyrian.xpm $fs/usr/share/pixmaps
	cp $SOURCE/tyrian21/* $fs/usr/share/opentyrian
	rm -rf $fs/usr/share/opentyrian/*exe
	rm -rf $fs/usr/share/opentyrian/*doc
	cat > $fs/usr/bin/tyrian <<EOF
#!/bin/sh
here=$(pwd)
cd /usr/share/opentyrian
./tyrian
cd $here
EOF
	chmod +x $fs/usr/bin/tyrian
}

