# SliTaz package receipt.

PACKAGE="linux-source"
VERSION="2.6.25.5"
CATEGORY="development"
SHORT_DESC="The Linux kernel source files."
MAINTAINER="pascal.bellard@slitaz.org"
WANTED="linux"
WEB_SITE="http://www.kernel.org/"
DEPENDS="linux slitaz-toolchain"

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
    mkdir -p $fs/usr/src/linux-$VERSION-slitaz $fs/lib/modules/$VERSION-slitaz/
    ln -s linux-$VERSION-slitaz $fs/usr/src/linux
    cp -a $src/slitaz $fs/usr/src/linux-$VERSION-slitaz
    ln -s /usr/src/linux-$VERSION-slitaz $fs/lib/modules/$VERSION-slitaz/source
    ln -s /usr/src/linux-$VERSION-slitaz $fs/lib/modules/$VERSION-slitaz/build
}

# Post install/remove commands for Tazpkg.
post_install()
{
	local url
	local patch_file
	cd $1/usr/src/
	url=$(cat linux-$VERSION-slitaz/slitaz/url)
	wget -c $url
	tar xjf $(basename $url)
	mv linux-$VERSION-slitaz/slitaz linux-$VERSION
	rmdir linux-$VERSION-slitaz
	mv linux-$VERSION linux-$VERSION-slitaz
	cd linux-$VERSION-slitaz
	while read patch_file; do
		echo "Apply $patch_file"
		patch -p1 < slitaz/$patch_file
	done < slitaz/patches
	cp slitaz/config .config
}

pre_remove()
{
	rm $(basename $(cat /usr/src/linux-$VERSION-slitaz/slitaz/url))
}

post_remove()
{
	rm -rf /usr/src/linux-$VERSION-slitaz
}

