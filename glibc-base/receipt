# SliTaz package receipt.

PACKAGE="glibc-base"
VERSION="2.11.2"
CATEGORY="base-system"
SHORT_DESC="GNU libc minimal libraries and UTF-8 support for SliTaz."
WEB_SITE="http://www.gnu.org/software/libc/"
WANTED="glibc"
MAINTAINER="pankso@slitaz.org"

DEFAULT_LOCALE="de_DE en_US en_GB es_ES fr_FR pt_BR pt_PT ru_RU"

# Rules to gen a SliTaz package suitable for Tazpkg.
#
# Full glibc is very long to compile (see package glibc for more
# informations). You can use the precompiled package available on
# SliTaz mirror to build a distro without recompiling glibc.
#
genpkg_rules()
{
	# Mkdir's.
	for dir in `cat stuff/mkdir.list`
	do
		mkdir -p ${fs}$dir
	done
    # Copy all files specified in stuff/files.list. We get the files
    # from glibc package.
    for file in `cat stuff/wanted-files.list`
    do
    	cp -a ${_pkg}$file ${fs}$file
    done
    # i18n
    for i in $DEFAULT_LOCALE
	do
		cp $_pkg/usr/share/i18n/locales/$i $fs/usr/share/i18n/locales
	done
}

# Call ldconfig and remove old glibc-2.3.6 (slitaz 1.0) and glibc-2.7
# files.
pre_install()
{
	rm -f $1/usr/lib/locale/locale-archive
}

post_install()
{
	for i in $(grep $VERSION.so $1/var/lib/tazpkg/installed/files.list); do
		for lib in $1$(echo $i | sed "s/$VERSION/*/"); do
			[ $lib == $1$i ] && continue
			rm -f $lib
		done
	done
}
