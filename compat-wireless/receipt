# SliTaz package receipt.

PACKAGE="compat-wireless"
VERSION="2009-04-08"
CATEGORY="base-system"
SHORT_DESC="Linux wireless driver update."
MAINTAINER="pascal.bellard@slitaz.org"
WEB_SITE="http://wireless.kernel.org/"
TARBALL="$PACKAGE-old-$VERSION.tar.bz2"
WGET_URL="${WEB_SITE}download/$PACKAGE-2.6/$TARBALL"
BUILD_DEPENDS="lzma"
PROVIDE="linux-wireless"

# Rules to configure and make the package.
compile_rules()
{
	local kver
	local kpath

	mv $PACKAGE-2.6-old $src 2> /dev/null
	cd $src
	# get kernel version
	if [ ! -d $WOK/linux/taz ]; then
		tazwok cook linux
	fi
	kpath=$WOK/linux/$(ls $WOK/linux/taz)
	kver=$(grep "kernel version" $kpath/.config)
	kver=${kver##* }
	IFS='.'; set -- $kver ; unset IFS
	if [ $1 -ne 2 -o $2 -ne 6 -o $3 -lt 22 -o $3 -gt 27 ]; then
		cat <<EOT
Wrong linux version $kver
Supported versions are 2.6.22 - 2.6.27
EOT
		return 1
	fi
	make KLIB=$kpath KLIB_BUILD=$kpath
	make -C $kpath M=$PWD INSTALL_MOD_PATH=$PWD/_pkg modules_install
	mkdir -p _pkg/usr/lib/compat-wireless/ _pkg/usr/sbin
	$WOK/linux/stuff/gztazmod.sh _pkg/lib/modules/*-slitaz
	cp scripts/modlib.sh _pkg/usr/lib/compat-wireless/
	cp scripts/*load scripts/*able _pkg/usr/sbin
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	cp -a $_pkg/usr $_pkg/lib $fs
	rm -f $fs/lib/modules/*-slitaz/modules.*
	sed -i 's|/bin/bash|/bin/ash|' $_pkg/usr/sbin/* $_pkg/usr/lib/*/*
}

# Post install/remove commands for Tazpkg.
post_install()
{
	depmod -a -b "$1/"
}

post_remove()
{
	depmod -a
}
