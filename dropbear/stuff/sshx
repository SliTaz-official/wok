#!/bin/sh

xdbclient()
{
	read host type data
	svr=$(echo $DISPLAY | sed 's/.*:\([0-9]*\).*/\1/')
	n=$((10+$svr)); dpy=localhost:$n
	dbclient -f -R $((6000+$n)):localhost:$((6000+$svr)) "$@" \
	    "xauth add $dpy $type $data; export DISPLAY=$dpy; $TERM || xterm" \
	    < /dev/null > /dev/null 2>&1
}

case "$DISPLAY" in
'')	dbclient "$@" ;;
*)	xauth list $DISPLAY | xdbclient "$@" ;;
esac
