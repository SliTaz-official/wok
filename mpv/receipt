# SliTaz package receipt.

PACKAGE="mpv"
VERSION="0.17.0"
CATEGORY="multimedia"
SHORT_DESC="Video player based on ffmpeg & mplayer2"
MAINTAINER="slitaz"
LICENSE="GPL2"
TARBALL="$PACKAGE-$VERSION.tar.gz"
WEB_SITE="http://mpv.io"
WGET_URL="https://github.com/mpv-player/mpv/archive/v$VERSION.tar.gz"
WAFTOOL="waf-1.8.12"
EXTRA_SOURCE_FILES="$WAFTOOL"

DEPENDS="lcms xorg-libXv xorg-libX11 xorg-libXext glibc-base libxcb alsa-lib \
liblzma bzlib zlib libjpeg libv4l libdrm xorg-libXinerama xorg-libXrandr mesa \
libegl-mesa xorg-libXau xorg-libXdmcp libpng glib pcre libxml2 libtasn1 nettle \
gmp libtinfo xorg-libXrender xorg-libXdamage xorg-libXfixes libxcb \
xorg-libXxf86vm udev lua ffmpeg"
BUILD_DEPENDS="file sed yasm lcms2-dev xorg-libXv-dev xorg-libX11-dev \
xorg-libXext-dev glibc-dev libxcb-dev alsa-lib-dev liblzma-dev bzlib zlib-dev \
jpeg-dev libv4l-dev libdrm-dev xorg-libXinerama-dev xorg-libXrandr-dev \
mesa-dev libegl-mesa xorg-libXau-dev xorg-libXdmcp-dev libpng-dev glib-dev \
pcre-dev libxml2-dev libtasn1-dev nettle-dev gmp-dev libtinfo \
xorg-libXrender-dev xorg-libXdamage-dev xorg-libXfixes-dev libxcb-dev \
xorg-libXxf86vm-dev udev-dev ffmpeg-dev"

# Rules to configure and make the package.
compile_rules()
{
	[ -s $SOURCES_REPOSITORY/$WAFTOOL ] || wget -P $SOURCES_REPOSITORY \
		http://www.freehackers.org/~tnagy/release/$WAFTOOL
	install -m 755 $SOURCES_REPOSITORY/$WAFTOOL waf
	./bootstrap.py
	./waf configure \
		--prefix=/usr \
		--confdir=/etc/mpv \
		--enable-openal \
		--disable-debug \
		--disable-oss-audio \
		--disable-manpage-build \
		--disable-libass

	./waf build
	./waf install --destdir=$DESTDIR
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir $install/etc
	mkdir $install/etc/mpv
	cp $WOK/$PACKAGE/source/$PACKAGE-$VERSION/etc/*.conf $install/etc/mpv
	cp -a $install/* $fs
}
