#!/bin/sh

server=""
if [ -x /usr/bin/ssh ]; then
	echo -n "SSH server: "
	read -t 300 server || exit 1
fi
[ -n "$server" ] || exec /bin/login
sshport=""
case "$server" in
*:*)	sshport="-p ${server#*:}"
	server=${server%:*};;
esac
if [ -x /usr/bin/knock ]; then
	case "$server" in
	!*)	server=${server#*!}"
		echo -n "Knock sequence (port[:proto]...): "
		read -t 30 sequence && knock ${server#*@} $sequence
	esac
fi
case "$server" in
*@*)	;;
*)	echo -n "$server login: "
	read -t 30 user || exit 1
	server="$user@$server";;
esac
sshargs="-oPreferredAuthentications=keyboard-interactive,password -oNoHostAuthenticationForLocalhost=yes -oLogLevel=FATAL -F/dev/null";
[ -L /usr/bin/ssh ] && sshargs=""
exec ssh $sshport $sshargs $server
