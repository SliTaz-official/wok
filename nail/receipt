# SliTaz package receipt.

PACKAGE="nail"
VERSION="12.4"
CATEGORY="network"
SHORT_DESC="Text mode mail user agent."
MAINTAINER="sygne@ombres.eu"
DEPENDS="openssl libkrb5"
BUILD_DEPENDS="openssl-dev"
SOURCE="mailx"
TARBALL="$SOURCE-$VERSION.tar.bz2"
WEB_SITE="http://heirloom.sourceforge.net/mailx.html"
WGET_URL="$SF_MIRROR/heirloom/$TARBALL"

# Rules to configure and make the package.
compile_rules()
{
	cd $src

	# avoid compiling with kerberos authentification:	
	make config.h
	sed -i -e "/GSSAPI/d" config.h
	sed -i -e "/gssapi/d" config.h
	
	make install UCBINSTALL=/usr/bin/install \
	DESTDIR=$PWD/_pkg PREFIX=/usr	
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p $fs/usr
	cp -r $_pkg/usr/bin $fs/usr
	strip -s $fs/usr/bin/*
	mv $fs/usr/bin/mailx $fs/usr/bin/nail
	
	cp -r $_pkg/etc $fs
}

# Pre and post install commands for Tazpkg.
pre_install()
{
	echo ""
	echo "Processing pre_install commands"
	echo ""
	echo "Moving $1/etc/nail.rc to $1/etc/nail.rc.old"
	echo ""
	mv $1/etc/nail.rc $1/etc/nail.rc.old
}

# Post install commands for Tazpkg.
# Check mailx
post_install()
{
	. $1/etc/init.d/rc.functions

	if [ -e $1/usr/bin/mailx ]; then
		echo ""
		echo "/usr/bin/mailx exists"
		echo -n "Do you want /usr/bin/nail for /usr/bin/mailx (y/N) ? : "
		read anser
		if [ "$anser" == "y" ]; then
			echo ""
			echo -n "linking /usr/bin/mailx to /usr/bin/nail"
			rm $1/usr/bin/mailx
			ln -s /usr/bin/nail $1/usr/bin/mailx
			status
		else
			echo ""
			echo "Doing nothing with /usr/bin/mailx"
			echo ""
		fi
	else
		echo -n "linking /usr/bin/mailx to /usr/bin/nail"
		ln -s /usr/bin/nail $1/usr/bin/mailx
		status
	fi
}
