# SliTaz package receipt.

PACKAGE="slitaz-boot-scripts"
VERSION="1.2"
CATEGORY="base-files"
SHORT_DESC="Provide all the initialisation scripts used at boot time."
MAINTAINER="pankso@slitaz.org"
TARBALL="$PACKAGE-$VERSION.tar.gz"
WEB_SITE="http://www.slitaz.org/"
WGET_URL="http://download.tuxfamily.org/slitaz/sources/boot-scripts/$TARBALL"

# Rules to gen a SliTaz package suitable for Tazpkg.
#
# This package is all build by genpkg, it provide the boot scripts found
# in /etc/init.d with the main config file : /etc/rcS.conf. It provide also
# the default inittab and the network config file used with network.sh
#
genpkg_rules()
{
	cp -a $src/etc $fs
	
	# Perms
	chown -R root.root $fs/etc/init.d
	chmod 755 $fs/etc/init.d/*.sh
	chmod 755 $fs/etc/init.d/rc*
}

# Pre install commands for upgrade from 1.2 to 1.3.
#
pre_install()
{
 	local root
 	root=$1
	echo "Checking for version compatibility..."
	if [ -d "$root/etc/rc.d" ]; then
		rm -rf $root/etc/rc.d
		rm -rf $root/etc/rc.scripts
	fi
	# Remove motd to be rebuils by /etc/init.d/i18n.sh in
	# the right language.
	rm -f $root/etc/motd
	
	# Backup file to restore with post install
	echo -n "Creating backups of configs..."
	cp $root/etc/rcS.conf $root/etc/rcS.conf.bak
	cp $root/etc/network.conf $root/etc/network.conf.bak
	cp $root/etc/inittab $root/etc/inittab.bak
	cp $root/etc/init.d/local.sh $root/etc/init.d/local.sh.bak
	status
}

post_install()
{
 	local root
 	root=$1
	echo -n "Restoring configs backups..."
	mv -f $root/etc/rcS.conf.bak $root/etc/rcS.conf
	mv -f $root/etc/network.conf.bak $root/etc/network.conf
	mv -f $root/etc/inittab.bak $root/etc/inittab
	mv -f $root/etc/init.d/local.sh.bak $root/etc/init.d/local.sh
	status
}

