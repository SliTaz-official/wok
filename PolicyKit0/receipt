# SliTaz package receipt.

PACKAGE="PolicyKit0"
SOURCE="POLICY_KIT"
VERSION="0_9"
CATEGORY="system-tools"
SHORT_DESC="Application development toolkit for controlling system-wide privileges."
MAINTAINER="rcx@zoominternet.net"
DEPENDS="glibc-base glib dbus dbus-glib expat"
BUILD_DEPENDS="slitaz-toolchain m4 autoconf automake libtool glib-dev intltool \
dbus-dev dbus-glib-dev expat-dev gettext pam-dev pam"
TARBALL="${SOURCE}_${VERSION}.tar.bz2"
WEB_SITE="http://www.freedesktop.org/wiki/Software/PolicyKit/"
WGET_URL="http://cgit.freedesktop.org/PolicyKit/snapshot/$TARBALL"

# Rules to configure and make the package.
compile_rules()
{
	mv ${SOURCE}_${VERSION} $SOURCE-$VERSION
	cd $src

	# autogen.sh forces some unnecessary options; remove them
	sed -i 's/gtkdocize /echo /' $src/autogen.sh || exit 1
	sed -i 's/--enable-gtk-doc//' $src/autogen.sh || exit 1
	sed -i 's/--enable-maintainer-mode//' $src/autogen.sh || exit 1
	sed -i 's/ doc / /' $src/Makefile.am || exit 1
	sed -i 's|doc/Makefile||' $src/configure.in || exit 1
	sed -i 's|doc/version.xml||' $src/configure.in || exit 1
	sed -i 's|doc/man/Makefile||' $src/configure.in || exit 1
	sed -i 's|GTK_DOC_CHECK(\[1.3\])||' $src/configure.in || exit 1
	rm -r -f $src/docs

    ./autogen.sh \
    	--prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--libexecdir=/usr/lib/PolicyKit0 \
		$CONFIGURE_ARGS  &&
    make &&
    make DESTDIR=$src/_pkg install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p  $fs/usr/lib
	cp -a $_pkg/usr/bin $fs/usr
	cp -a $_pkg/etc $fs
	cp -a $_pkg/usr/lib/*.so* $fs/usr/lib
	cp -a $_pkg/usr/lib/PolicyKit0 $fs/usr/lib
	cp -a $_pkg/var $fs

	mkdir -p $fs/usr/share
	cp -a $_pkg/usr/share/dbus-1 $fs/usr/share
	cp -a $_pkg/usr/share/PolicyKit $fs/usr/share
}
