# SliTaz package receipt.

PACKAGE="distcc"
VERSION="3.1"
CATEGORY="development"
SHORT_DESC="Distributed compilation for C/C++"
MAINTAINER="erjo@slitaz.org"
LICENSE="GPL2"
TARBALL="$PACKAGE-$VERSION.tar.bz2"
WEB_SITE="http://distcc.org"
WGET_URL="http://distcc.googlecode.com/files/$TARBALL"

DEPENDS="popt lzo"
BUILD_DEPENDS="popt-dev lzo-dev python-dev gtk+-dev libgnome-dev \
libgnomeui-dev libbonoboui-dev libgnomecanvas-dev libgnome-keyring-dev"

# Rules to configure and make the package.
compile_rules()
{
	export CFLAGS="-Wno-error=unused-but-set-variable"
	cd $src
	./configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--mandir=/usr/share/man \
		--with-gnome \
		--with-gtk \
		$CONFIGURE_ARGS &&
	make && make DESTDIR=$DESTDIR install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p $fs/usr \
		$fs/var/log/distccd \
		$fs/etc/init.d
		
	cp -a $install/usr/bin $fs/usr
	cp -a $install/etc/distcc $fs/etc
	
	echo '127.0.0.1' >> $fs/etc/distcc/clients.allow
	
	install -o root -g root $stuff/distccd $fs/etc/init.d
}

post_install()
{
	if ! grep -q nagios $1/etc/passwd; then
		echo -n "Adding user/group nagios..."
		chroot $1/ addgroup -S distcc
		chroot $1/ adduser -S -D -H -G distcc distcc
		status
	fi
	
	# Fix perms for files and directories
	chroot $1/ chown -R distcc.distcc /var/log/distccd
	  
	cat <<EOF
----
Now you can:
* Just run '/etc/init.d/distccd start' to start daemon.
* Add distccd to RUN_DAEMONS in /etc/rcS.conf to run distccd Ã at boot time.
* Allow cliets in /etc/distcc/clients.allow
----

EOF
}
