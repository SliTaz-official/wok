# SliTaz package receipt.

PACKAGE="pulseaudio"
VERSION="8.0"
CATEGORY="multimedia"
SHORT_DESC="A sound system for POSIX OSes"
MAINTAINER="pascal.bellard@slitaz.org"
LICENSE="LGPL2.1 GPL2 MIT"
WEB_SITE="https://www.freedesktop.org/wiki/Software/PulseAudio/"

TARBALL="$PACKAGE-$VERSION.tar.xz"
WGET_URL="http://freedesktop.org/software/pulseaudio/releases/$TARBALL"

DEPENDS="libcap libjson-c libsndfile flac libvorbis dbus gdbm libcap attr \
speex libsamplerate libltdl"
BUILD_DEPENDS="pkg-config libtool automake autoconf intltool m4 libcap-dev \
libjson-c-dev libsndfile-dev flac-dev libvorbis-dev util-linux-uuid-dev \
dbus-dev speex-dev udev-dev libsamplerate-dev alsa-lib-dev file"
SPLIT="pulseaudio-locale pulseaudio-man pulseaudio-vala pulseaudio-dev"

# Rules to configure and make the package.
compile_rules()
{
	grep -rsl 'uname -m' $src | xargs sed -i 's|uname -m|echo i686|'
	./bootstrap.sh
	./configure \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--disable-bluez4 \
		--disable-systemd-daemon \
		--disable-systemd-login \
		--disable-systemd-journal \
		--disable-oss-output \
		--disable-oss-wrapper \
		--disable-esound \
		--disable-rpath \
		--with-udev-rules-dir=/etc/udev/rules.d \
		$CONFIGURE_ARGS &&
	make &&
	make -j1 install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	cook_copy_folders bin
	cook_copy_files *.pa *.conf *.rules *.desktop *.so*
	find $fs -name '*console-kit*' -delete
}
