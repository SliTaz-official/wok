# SliTaz package receipt.

PACKAGE="linux-x86_64-api-headers"
VERSION="3.2.14"
KBASEVER="${VERSION:0:3}"
CATEGORY="development"
SHORT_DESC="Kernel headers sanitized for use in userspace."
MAINTAINER="erjo@slitaz.org"
SOURCE="linux"
TARBALL="$SOURCE-$KBASEVER.tar.xz"
WEB_SITE="http://www.kernel.org/"
WGET_URL="http://www.kernel.org/pub/linux/kernel/v3.0/$TARBALL"

BUILD_DEPENDS="bash"

[ "$KBASEVER" != "$VERSION" ] && PATCH="http://www.kernel.org/pub/linux/kernel/v3.0/patch-$VERSION.xz"

# Cross toolchain variables.
CROSS_TARGET="x86_64-slitaz-linux"
CROSS_PREFIX="/usr/cross/x86_64"

# Rules to configure and make the package.
compile_rules()
{
	cd $src

	if [ "$KBASEVER" != "$VERSION" ]; then
		if [ -f $SOURCES_REPOSITORY/$(basename $PATCH) ]; then
			xzcat $SOURCES_REPOSITORY/$(basename $PATCH) | patch -Np1
		else
			wget $PATCH -O $SRC/$(basename $PATCH)
			xzcat $SRC/$(basename $PATCH) | patch -Np1
		fi
	fi

	make mrproper &&
	make ARCH=x86_64 headers_check &&
	make ARCH=x86_64 \
		INSTALL_HDR_PATH=${DESTDIR}${CROSS_PREFIX} \
		headers_install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p $fs/usr
	cp -a $install/usr/cross $fs/usr
	rm -f $(find ${fs} -name .install -or -name ..install.cmd)
}
