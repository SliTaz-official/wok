# SliTaz package receipt.

PACKAGE="xorg-server-Xvesa"
VERSION="1.5.3"
CATEGORY="x-window"
SHORT_DESC="Xorg kdrive server Xvesa (tinyX)."
MAINTAINER="pankso@slitaz.org"
DEPENDS="xorg-libXau xorg-libfontenc xorg-libXdmcp xorg-libXfont \
xorg-base-fonts freetype zlib hal dbus"
SUGGESTED="xorg-xrandr"
WANTED="xorg-server-tinyX"
SOURCE="xorg-server"
WEB_SITE="http://www.x.org/"

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	_pkg=$WOK/$WANTED/$SOURCE-$VERSION/_pkg
	mkdir -p $fs/usr/bin $fs/etc/X11
	cp -a $_pkg/usr/bin/Xvesa $fs/usr/bin
	chmod 4711 $fs/usr/bin/Xvesa
}

post_install()
{
	# Upgrade from 1.2.0 to 1.5.3
	if ! grep -q "\-keybd keyboard" $1/etc/slim.conf; then
		echo -n "Updating Slim configuration..."
		res=$(grep ^xserver_arguments $1/etc/slim.conf | \
			sed 's/xserver_arguments.*-screen *//' | awk '{ print $1 }')
		sed -i s/"-screen $res"/"-screen $res -keybd keyboard -mouse mouse,5,\/dev\/input\/mice -nolisten tcp"/ \
			$1/etc/slim.conf
		status
	fi
}
