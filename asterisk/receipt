# SliTaz package receipt.

PACKAGE="asterisk"
VERSION=
CATEGORY="system"
SHORT_DESC="Open Source PBX and telephony toolkit."
MAINTAINER="pascal.bellard@slitaz.org"
WEB_SITE="http://www.digium.com/"
WANTED="bristuff"
DEPENDS="openssl ncurses zlib libogg libvorbis curl newt libusb alsa-lib \
speex iksemel spandsp tiff radiusclient-ng nbs freetds libpostgresqlclient \
libmysqlclient"
CONFIG_FILES="/etc/asterisk"

# Extract VERSION from WANTED package source
get_version()
{
	eval $(grep ^AST_VER= $WOK/$WANTED/$WANTED-*/download.sh)
	VERSION=$AST_VER
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	if [ -d taz/$PACKAGE-/fs ]; then
		get_version
		sed -i "s/^VERSION=.*/VERSION=\"$VERSION\"/" receipt
		mv taz/$PACKAGE- taz/$PACKAGE-$VERSION
	fi
	_pkg=$(cd $(dirname $src)/$WANTED-*/_pkg ; pwd)
	while read file; do
		dir=$(dirname $file)
		[ -d $fs$dir ] || mkdir -p $fs$dir
		eval cp -a "$_pkg$file" $fs$dir
	done < $_pkg/../$PACKAGE.files-list
	for i in $fs/etc/asterisk/*.sample; do
		mv $i ${i%.sample}
	done
}

# Pre and post install commands for Tazpkg.
post_install()
{
	( cd $1/ ; cpio -o -H newc | gzip -9 ) > \
		$1/$INSTALLED/$PACKAGE/volatile.cpio.gz <<EOT
$(cd $1/ ; find etc/asterisk -type f)
EOT
}

repack_cleanup()
{
        zcat $INSTALLED/$PACKAGE/volatile.cpio.gz | ( cd $1 ; cpio -id )
}
