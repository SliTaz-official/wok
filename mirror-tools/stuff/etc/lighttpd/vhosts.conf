# /etc/lighttpd/vhosts.conf : Virtual hosts configuration file.
#

# Example.org
#
#$HTTP["host"] =~ "(^|\.)example\.org$" {
  #server.document-root = "/var/www/vhost/exemple.com/html"
  #server.errorlog = "/var/log/lighttpd/example.org-error.log"
  #accesslog.filename = "/var/log/lighttpd/example.org-access.log"
#}

# mirror.slitaz.org (Server canonical hostname)
#
$HTTP["host"] =~ "^mirror([0-9]*)\.slitaz\.org$" {
  server.document-root = "/var/www/slitaz/mirror"
  server.errorlog = "/var/log/lighttpd/mirror.slitaz.org-error.log"
  accesslog.filename = "/var/log/lighttpd/mirror.slitaz.org-access.log"
  
  include "awstats.conf"
  
  alias.url += ( "/info" => "/var/www/mirror-info/" )
  
  alias.url += ( "/pizza" => "/var/www/pizza/" )
  
  alias.url += ( "/doc" => "/var/www/doc/" )
  var.dokudir = "/doc"
  # Rewrites for dokuwiki
  url.rewrite = (
    "^" + var.dokudir + "/lib/.*$"              => "$0",
     "^" + var.dokudir + "/_media/(.*)?\?(.*)$"  => var.dokudir + "/lib/exe/fetch.php?media=$1&$2",
     "^" + var.dokudir + "/_media/(.*)$"         => var.dokudir + "/lib/exe/fetch.php?media=$1",
     "^" + var.dokudir + "/_detail/(.*)?\?(.*)$" => var.dokudir + "/lib/exe/detail.php?media=$1&$2",
     "^" + var.dokudir + "/_detail/(.*)?$"       => var.dokudir + "/lib/exe/detail.php?media=$1",
     "^" + var.dokudir + "/_export/([^/]+)/(.*)\?(.*)$" => var.dokudir + "/doku.php?do=export_$1&id=$2&$3",
     "^" + var.dokudir + "/_export/([^/]+)/(.*)" => var.dokudir + "/doku.php?do=export_$1&id=$2",
     "^" + var.dokudir + "/doku.php.*"           => "$0",
     "^" + var.dokudir + "/feed.php.*"           => "$0",
     "^" + var.dokudir + "/(.*)\?(.*)"           => var.dokudir + "/doku.php?id=$1&$2",
     "^" + var.dokudir + "/(.*)"                 => var.dokudir + "/doku.php?id=$1"
  )

  alias.url += ( "/webboot" => "/var/www/boot/" )

  alias.url += ( "/pkgs" => "/var/www/pkgs/" )
  index-file.names += ( "search.sh" )
  cgi.assign += (
    ".sh" => "/bin/sh"
  )

  alias.url += ( "/hg" => "/var/www/hg/" )
###  url.rewrite-once = ( "/hg(.*)" => "/hg/hgwebdir.py$1" )
  index-file.names += ( "hgwebdir.py" )
  cgi.assign += (
    ".py" => "/usr/bin/python"
  )

  alias.url += ( "/www" => "/home/slitaz/website" )
  
#  alias.url += ( "/tiny" => "/var/www/pizza/tiny/demos/192.168.0.6/var/www" )
#  index-file.names += ( "index.sh" )
  
  index-file.names += ( "index.html" )
  index-file.names += ( "index.php" )
  # Last but not least...
  index-file.names += ( "/dir-generator.php" )
}

## info.mirror.slitaz.org
##
#$HTTP["host"] =~ "^info\.mirror\.slitaz\.org$" {
#  server.document-root = "/var/www/mirror-info/"
#  server.errorlog = "/var/log/lighttpd/info.mirror.slitaz.org-error.log"
#  accesslog.filename = "/var/log/lighttpd/info.mirror.slitaz.org-access.log"
#  include "awstats.conf"
#}

$HTTP["host"] =~ "ajaxterm\.slitaz\.org$" {
  proxy.server = ( "/" => 
  	( ( "host" => "127.0.0.1", "port" => 8022 ) )
  )
}

# pizza.slitaz.org (Server canonical hostname)
#
$HTTP["host"] =~ "^pizza\.slitaz\.org$" {
  server.document-root = "/var/www/pizza"
  server.errorlog = "/var/log/lighttpd/pizza.slitaz.org-error.log"
  accesslog.filename = "/var/log/lighttpd/pizza.slitaz.org-access.log"
  include "awstats.conf"
  index-file.names += ( "index.php" )
}

# slitaz.org
#
#$HTTP["host"] =~ "(^|www\.)slitaz\.org$" {
$HTTP["host"] =~ "www\.slitaz\.org$" {
  server.document-root = "/home/slitaz/website"
  server.errorlog = "/var/log/lighttpd/slitaz.org-error.log"
  accesslog.filename = "/var/log/lighttpd/slitaz.org-access.log"
  include "awstats.conf"
  
###  index-file.names = ( "index.html" )
  index-file.names += ( "start.html" )
  
  
###  url.rewrite-once = (
###    "^/about" => "/fr/about",
###	"^/artwork" => "/fr/artwork",
###	"^/devel" => "/fr/devel",
###    "^/doc" => "/fr/doc",
###	"^/get" => "/fr/get",
###	"^/packages" => "/fr/packages"
###  )
 
}

# doc.slitaz.org
#
$HTTP["host"] =~ "doc\.slitaz\.org$" {
  server.document-root = "/var/www/doc"
  server.errorlog = "/var/log/lighttpd/doc.slitaz.org-error.log"
  accesslog.filename = "/var/log/lighttpd/doc.slitaz.org-access.log"
  index-file.names = ("doku.php")
  var.dokudir = ""
  # Rewrites for dokuwiki
  url.rewrite = (
    "^" + var.dokudir + "/lib/.*$"              => "$0",
     "^" + var.dokudir + "/_media/(.*)?\?(.*)$"  => var.dokudir + "/lib/exe/fetch.php?media=$1&$2",
     "^" + var.dokudir + "/_media/(.*)$"         => var.dokudir + "/lib/exe/fetch.php?media=$1",
     "^" + var.dokudir + "/_detail/(.*)?\?(.*)$" => var.dokudir + "/lib/exe/detail.php?media=$1&$2",
     "^" + var.dokudir + "/_detail/(.*)?$"       => var.dokudir + "/lib/exe/detail.php?media=$1",
     "^" + var.dokudir + "/_export/([^/]+)/(.*)\?(.*)$" => var.dokudir + "/doku.php?do=export_$1&id=$2&$3",
     "^" + var.dokudir + "/_export/([^/]+)/(.*)" => var.dokudir + "/doku.php?do=export_$1&id=$2",
     "^" + var.dokudir + "/doku.php.*"           => "$0",
     "^" + var.dokudir + "/feed.php.*"           => "$0",
     "^" + var.dokudir + "/(.*)\?(.*)"           => var.dokudir + "/doku.php?id=$1&$2",
     "^" + var.dokudir + "/(.*)"                 => var.dokudir + "/doku.php?id=$1"
  )
}

# boot.slitaz.org
#
$HTTP["host"] =~ "boot\.slitaz\.org$" {
  server.document-root = "/var/www/boot"
  server.errorlog = "/var/log/lighttpd/boot.slitaz.org-error.log"
  accesslog.filename = "/var/log/lighttpd/boot.slitaz.org-access.log"
}

# pkgs.slitaz.org
#
$HTTP["host"] =~ "pkgs\.slitaz\.org$" {
  server.document-root = "/var/www/pkgs"
  server.errorlog = "/var/log/lighttpd/pkgs.slitaz.org-error.log"
  accesslog.filename = "/var/log/lighttpd/pkgs.slitaz.org-access.log"
  index-file.names += ( "search.sh" )
  cgi.assign = (
    ".sh" => "/bin/sh"
  )
}

# hg.slitaz.org (Mercurial repos)
#
$HTTP["host"] =~ "hg\.slitaz\.org" {
  cgi.assign = (
    ".py" => "/usr/bin/python"
  )
  server.document-root = "/var/www/hg"
#  url.rewrite-once = ( "(.*)" => "/hgwebdir.py$1" )
  index-file.names += ( "hgwebdir.py" )
}

# scn.slitaz.org (SliTaz Community Network)
#
$HTTP["host"] =~ "scn\.slitaz\.org$" {
  server.document-root = "/var/www/scn"
  server.errorlog = "/var/log/lighttpd/scn.slitaz.org-error.log"
  accesslog.filename = "/var/log/lighttpd/scn.slitaz.org-access.log"
  url.rewrite-final = (
    "^/system/test/(.*)$" => "/index.php?q=system/test/$1",
    "^/([^.?]*)\?(.*)$" => "/index.php?q=$1&$2",
    "^/([^.?]*)$" => "/index.php?q=$1",
    "^/rss.xml" => "/index.php?q=rss.xml"
  )
}
