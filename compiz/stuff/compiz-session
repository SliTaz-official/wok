#!/bin/sh
#
# Start Compiz 3D Desktop on SliTaz. We use some LXDE componment
# and check compiz config files exist.
#

export XDG_CONFIG_HOME="$HOME/.config"
export XDG_CACHE_HOME="$HOME/.cache"
export XDG_CURRENT_DESKTOP=LXDE
export DESKTOP_SESSION=compiz

# Start DBUS session.
if [ ! "$DBUS_SESSION_BUS_ADDRESS" ]; then
	dbus-launch --sh-syntax --exit-with-session &
fi

# Compiz configuration files from slitaz-configs.
if [ ! -f "$XDG_CONFIG_HOME/compiz-1/compizconfig/config" ]; then
	mkdir -p $XDG_CONFIG_HOME/compiz-1/compizconfig
	cp -r /usr/share/slitaz/compiz/* $XDG_CONFIG_HOME/compiz-1/compizconfig
fi

# PCmanFM config file. NOTE: We dont need a user config file
#if [ ! -f "$XDG_CONFIG_HOME/pcmanfm/main" ]; then
	#mkdir -p $XDG_CONFIG_HOME/pcmanfm/default
	#cp /etc/xdg/pcmanfm/default/pcmanfm.conf \
		#$XDG_CONFIG_HOME/pcmanfm/default
#fi

# Start some LXDE componment.
lxpanel -p slitaz &
pcmanfm --desktop &
emerald &
exec compiz ccp --indirect-rendering
