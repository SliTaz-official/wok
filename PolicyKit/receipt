# SliTaz package receipt.

PACKAGE="PolicyKit"
VERSION="0.97"
CATEGORY="system-tools"
SHORT_DESC="Application development toolkit for controlling system-wide privileges."
MAINTAINER="rcx@zoominternet.net"
DEPENDS="glibc-base glib libgio dbus dbus-glib eggdbus expat pam"
BUILD_DEPENDS="slitaz-toolchain m4 autoconf automake libtool glib-dev intltool \
libxslt-dev expat-dev pam-dev pam gettext eggdbus eggdbus-dev dbus-dev dbus-glib-dev"
TARBALL="$PACKAGE-$VERSION.tar.bz2"
WEB_SITE="http://www.freedesktop.org/wiki/Software/PolicyKit/"
WGET_URL="http://cgit.freedesktop.org/$PACKAGE/snapshot/$TARBALL"

# Rules to configure and make the package.
compile_rules()
{
	cd $src

	# autogen.sh forces some unnecessary options, so remove them
	sed -i 's/gtkdocize /echo /' $src/autogen.sh || exit 1
	sed -i 's/--enable-gtk-doc//' $src/autogen.sh || exit 1
	sed -i 's/--enable-maintainer-mode//' $src/autogen.sh || exit 1
	sed -i 's/ docs / /' $src/Makefile.am || exit 1
	sed -i 's|docs/version.xml||' $src/configure.ac || exit 1
	sed -i 's|docs/extensiondir.xml||' $src/configure.ac || exit 1
	sed -i 's|docs/Makefile||' $src/configure.ac || exit 1
	sed -i 's|docs/polkit/Makefile||' $src/configure.ac || exit 1
	sed -i 's|docs/man/Makefile||' $src/configure.ac || exit 1
	sed -i 's|GTK_DOC_CHECK(\[1.3\])||' $src/configure.ac || exit 1
	rm -r -f $src/docs

    ./autogen.sh \
    	--prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--libexecdir=/usr/lib/PolicyKit \
		--disable-introspection \
		$CONFIGURE_ARGS  &&
    make &&
    make DESTDIR=$src/_pkg install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p  $fs/usr/lib
	cp -a $_pkg/usr/bin $fs/usr
	cp -a $_pkg/usr/lib/PolicyKit $fs/usr/lib
	cp -a $_pkg/etc $fs
	cp -a $_pkg/var $fs

	mkdir -p $fs/usr/share
	cp -a $_pkg/usr/share/dbus-1 $fs/usr/share
	cp -a $_pkg/usr/share/polkit-1 $fs/usr/share

	mkdir -p $fs/usr/lib/polkit-1/extensions
	cp -a $_pkg/usr/lib/*.so* $fs/usr/lib
	cp -a $_pkg/usr/lib/polkit-1/extensions/*.so* $fs/usr/lib/polkit-1/extensions
}
