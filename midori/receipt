# SliTaz package receipt.

PACKAGE="midori"
VERSION="0.5.0"
CATEGORY="x-window"
SHORT_DESC="Lightweight web browser based on GTK+/WebKit"
MAINTAINER="pankso@slitaz.org"
LICENSE="LGPL2.1"
TARBALL="$PACKAGE-$VERSION.tar.bz2"
WEB_SITE="http://twotoasts.de/index.php/midori/"
WGET_URL="http://archive.xfce.org/src/apps/$PACKAGE/${VERSION:0:3}/$TARBALL"
GENERIC_MENUS="no"

DEPENDS="libnotify libunique libwebkit xorg-libXss"
BUILD_DEPENDS="python vala glib-dev librsvg-apps libnotify-dev gtk+-dev \
xorg-libXss-dev libwebkit-dev libunique-dev desktop-file-utils-extra"

# Rules to configure and make the package.
compile_rules()
{
	./configure \
		--jobs=4 \
		--prefix=/usr \
		--disable-zeitgeist &&
	make &&
	make install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p \
		$fs/usr/share/doc/midori \
		$fs/usr/share/pixmaps \

	cp -a $install/etc $fs
	cp $stuff/config $fs/etc/xdg/midori
	# add SliTaz token to DDG, add Twitter search
	cd $fs && patch -p1 < $stuff/search.patch && status

	# Midori use sqlite to store bookmarks
	#cp $stuff/bookmarks.xbel $fs/etc/xdg/midori

	cp -a $install/usr/bin $fs/usr
	cp -a $install/usr/lib $fs/usr

	# desktop files
	cp -a $install/usr/share/applications $fs/usr/share
	find $fs -name '*.desktop' -exec sed -i \
		'/^Version/d; /^GenericName/d; /^X-/d; /^Name\[.*\]=Midori/d; \
		/^Actions=/d' \{\} \;
	desktop=$fs/usr/share/applications/midori.desktop
	lastline=$(expr $(grep -n '^\[Desktop Action TabNew\]' $desktop | \
		cut -d: -f1) - 2)
	head -n $lastline $desktop > $desktop.new
	mv -f $desktop.new $desktop

	cp -a $install/usr/share/doc/midori/faq* $fs/usr/share/doc/midori
	cp -a $install/usr/share/midori $fs/usr/share

	# Icons
	cp -a $install/usr/share/icons $fs/usr/share
	rm -rf $fs/usr/share/icons/hicolor/scalable
}
