#!/bin/sh

FILES=/var/lib/tazpkg/files.list.lzma
LIST=/tmp/command-list.gz
[ ! $LIST -nt $FILES ] && unlzma <$FILES | \
grep -E "(: $(echo ${PATH//:/|: }))" | gzip -9 >$LIST && chmod 666 $LIST

lookup() {
	zcat $LIST | grep "/$2$1$" | while read pkg file; do
		cat <<EOT
Command '$1' not found, but can be installed as root with:

tazpkg -gi ${pkg%:}
${2:+$2$1}
EOT
		break
	done
}

MSG="$(lookup "$1")"
[ "$MSG" ] || MSG="$(lookup "$1" get-)"
echo "${MSG:-${SHELL##*/}: $1: not found}"
