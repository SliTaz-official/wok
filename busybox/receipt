# SliTaz package receipt.

PACKAGE="busybox"
VERSION="1.10.1"
CATEGORY="base-system"
SHORT_DESC="Busybox combines tiny versions of many common UNIX utilities."
MAINTAINER="pascal.bellard@slitaz.org"
DEPENDS="slitaz-base-files"
BUILD_DEPENDS="bzip2"
TARBALL="$PACKAGE-$VERSION.tar.bz2"
WEB_SITE="http://www.busybox.net/"
WGET_URL="http://www.busybox.net/downloads/$TARBALL"

# Rules to configure and make the package.
compile_rules()
{
    cd $PACKAGE-$VERSION
    patch -p1 < ../stuff/$PACKAGE-$VERSION-patch.u
    patch -p1 < ../stuff/$PACKAGE-$VERSION-vcsa2txt.u
    patch -p1 < ../stuff/$PACKAGE-$VERSION-cpio.u
    patch -p1 < ../stuff/$PACKAGE-$VERSION-dhcpc.u
    patch -p1 < ../stuff/$PACKAGE-$VERSION-cpio-mkdir.u
    cp ../stuff/$PACKAGE-$VERSION.config .config
    make oldconfig
    make && make install
    echo "Chmod 4755 on busybox binary..."
    chmod 4755 _install/bin/busybox
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
    cp -a $src/_install/* $fs
    mkdir $fs/etc
    # Busybox config files.
    cp stuff/busybox.conf $fs/etc
    chmod 600 $fs/etc/busybox.conf
    cp stuff/dnsd.conf $fs/etc
    cp stuff/udhcpd.conf $fs/etc
    cd $fs
    rm linuxrc
    ln -s bin/busybox init
    cd $WOK/$PACKAGE
    # Udhcpc stuff.
    mkdir -p $fs/usr/share/udhcpc
    cp $src/examples/udhcp/simple.script \
    $fs/usr/share/udhcpc/default.script
    chmod +x $fs/usr/share/udhcpc/default.script
}

# Force glibc-2.7 reinstall if 2.3.6 still in use.
pre_install()
{
	if grep -q 'VERSION="2.3.6"' /var/lib/tazpkg/installed/glibc-base/receipt; then
		tazpkg get-install glibc-base --forced
	fi
}
