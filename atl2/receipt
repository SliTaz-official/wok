# SliTaz package receipt.

PACKAGE="atl2"
VERSION="2.0.4"
CATEGORY="system-tools"
SHORT_DESC="Driver for the Atheros L2"
MAINTAINER="erjo@slitaz.org"
DEPENDS="linux"
TARBALL="$PACKAGE-$VERSION.tar.bz2"
WEB_SITE="http://atl2.sf.net/"
WGET_URL="http://people.redhat.com/csnook/atl2/atl2-2.0.4.tar.bz2"

# Rules to configure and make the package.
compile_rules()
{
	KVER=`grep  ^VERSION= $WOK/linux/receipt | cut -d "=" -f2 | sed -e 's/"//g'`
	if [ ! -d $WOK/linux/linux-$KVER ]; then
		tazwok cook linux
	fi
	cd $src
	make KSRC=$WOK/linux/linux-$KVER
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	KVER=`grep  ^VERSION= $WOK/linux/receipt | cut -d "=" -f2 | sed -e 's/"//g'`
	EXTRAVERSION=_$KVER
	
	mkdir -p $fs/lib/modules/${KVER}-slitaz/kernel/drivers/net
	
	# Find all modules (gztazmod.sh code).
	echo -n "Searching all modules to compress them... "
	find $src -name "*.ko" -exec lzma e '{}' '{}'.gz \;

	# copy module 
	cp -a $src/*.gz $fs/lib/modules/${KVER}-slitaz/kernel/drivers/net
}

# Post install/remove commands for Tazpkg.
post_install()
{
	chroot "$1/" depmod -a ${EXTRAVERSION#_}-slitaz
}

post_remove()
{
	depmod -a 
}
