# SliTaz package receipt.

PACKAGE="vlc"
VERSION="3.0.6"
CATEGORY="multimedia"
SHORT_DESC="MPEG, VCD/DVD, and DivX player"
MAINTAINER="jozee@slitaz.org"
LICENSE="GPL2"
TARBALL="$PACKAGE-$VERSION.tar.xz"
WEB_SITE="http://www.videolan.org/vlc/"
WGET_URL="http://download.videolan.org/pub/videolan/$PACKAGE/$VERSION/$TARBALL"
TAGS="audio video multimedia movie player"
COOKOPTS="!fixdesktops"

DEPENDS="libQtCore libQtGui libvlc gcc83-lib-base"
BUILD_DEPENDS="Qt4-dev alsa-lib-dev dbus-dev ffmpeg-dev gettext \
libmad-dev lua5.1-dev tar xcb-util-dev yasm expat-dev libxml2-dev libegl-mesa \
util-linux-uuid-dev x264-dev flac-dev taglib-dev gnutls-dev libupnp-dev \
libsamplerate-dev fribidi-dev zvbi-dev opus-dev gmp-dev ncurses-dev x265-dev \
libgnutls gcc83 gcc83-lib-base"

compile_rules()
{
	[ -s /var/lib/dbus/machine-id ] || dbus-uuidgen > /var/lib/dbus/machine-id
	cd $src
	[ -e /usr/bin/luac ] || ln -s luac5.1 /usr/bin/luac
	# export ncurses paths 
	export NCURSES_CFLAGS="-I/usr/include"
	export NCURSES_LIBS="-L/lib -lncurses -ltinfo"
	export CC=gcc-83 CXX=g++-83 BUILDCC=gcc-83
	./configure \
		--prefix=/usr \
		--disable-pulse \
		--disable-a52 \
		--disable-sout \
		--disable-libgcrypt \
		--enable-ncurses \
		$CONFIGURE_ARGS &&
	make &&
	make install
	[ -L /usr/bin/luac ] && rm -f /usr/bin/luac
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p $fs/usr/share/pixmaps
	cp -a $install/usr/bin $fs/usr
	cp -a $install/usr/share/$PACKAGE $fs/usr/share
	#Remove extra icons
	rm $fs/usr/share/$PACKAGE/*.ico
	#copy vlc icon
	cp -a $install/usr/share/icons/hicolor/16x16/apps/vlc.png $fs/usr/share/pixmaps
	#Remove unnecessary fonts
	rm $fs/usr/share/$PACKAGE/skins2/fonts/* 2> /dev/null || true
}
