#!/bin/sh
# 
# Gtkdialog box interafce for secure file transfer with scp from Dropbear.
# - SliTaz GNU/Linux 2008.
#
VERSION=20080415

# Interafce status with iwconfig without arguments to show all
# connections.
#
export IWCONFIG='
<window title="Wireless status" icon-name="network-wireless">
  <vbox>
    <text use-markup="true">
      <label>"
<b>Wireless status</b>"
      </label>
    </text>
    <text wrap="false">
      <input>date</input>
    </text>
    <frame Iwconfig>
      <text wrap="false" width-chars="58">
        <input>iwconfig 2>&1</input>
      </text>
    </frame>
    <hbox>
      <button>
        <input file icon="exit"></input>
        <action type="closewindow">IFCONFIG</action>
      </button>
    </hbox>
  </vbox>
</window>
'

# List loaded modules
#
export LSMOD='
<window title="Lsmod" icon-name="network-wireless">
  <vbox>
    <text use-markup="true">
      <label>"
<b>Active modules list</b>"
      </label>
    </text>
    <text wrap="false">
      <input>date</input>
    </text>
    <frame Lsmod>
      <text wrap="false" width-chars="58">
        <input>lsmod</input>
      </text>
    </frame>
    <hbox>
      <button>
        <input file icon="exit"></input>
        <action type="closewindow">IFCONFIG</action>
      </button>
    </hbox>
  </vbox>
</window>
'

# Main window.
export WIFI_DIALOG='
<window title="Wifibox" icon-name="network-wireless">
  <vbox>
 
    <text use-markup="true">
      <label>
"
<b>SliTaz - Wifibox</b>"
      </label>
    </text>
    <text wrap="true" width-chars="52" use-markup="true">
      <label>
"
Connect to a wireless station (without encryption).
"
      </label>
    </text>
    
    <notebook labels="Connection|Drivers">
    
    <frame Configuration>
      <hbox>
        <text use-markup="true">
          <label>"<b>Interface  :</b>"</label>
        </text>
        <entry>
          <default>wlan0</default>
          <variable>INTERFACE</variable>
        </entry>
      </hbox>
      <hbox>
        <text use-markup="true">
          <label>"<b>ESSID        :</b>"</label>
        </text>
        <entry>
          <default>any</default>
          <variable>ESSID</variable>
        </entry>
      </hbox>
      <hbox>
      <button>
        <label>Start</label>
        <input file icon="forward"></input>
        <action>iwconfig $INTERFACE essid $ESSID</action>
        <action>udhcpc -b -i $INTERFACE -p /var/run/udhcpc.$INTERFACE.pid</action>
      </button>
      <button>
        <label>Stop</label>
        <input file icon="stop"></input>
        <action>ifconfig $INTERFACE down</action>
        <action>kill `cat /var/run/udhcpc.$INTERFACE.pid`</action>
      </button>
    </hbox>
    </frame>
    
    <frame Kernel>
      <hbox>
        <text use-markup="true">
          <label>"<b>Module   :</b>"</label>
        </text>     
        <combobox>
          <variable>MODULE</variable>
          <item>ipw2200</item>
          <item>ipw2100</item>
          <item>bcm43xx</item>
          <item>b43</item>
          <item>b43legacy</item>
          <item>rt2500pci</item>
          <item>rt2x00usb</item>
          <item>rt2x00lib</item>
          <item>rt2400pci</item>
          <item>rt2x00pci</item>
          <item>rt2500usb</item>
          <item>zd1211rw</item>
        </combobox>
        <button>
          <label>Load</label>
          <input file icon="forward"></input>
	      <action>modprobe $MODULE</action>
        </button>
        <button>
        <label>Lsmod</label>
        <input file icon="computer"></input>
	    <action type="launch">LSMOD</action>
      </button>
      </hbox>
    </frame>
    
    </notebook>
    
    <hbox>
      <button>
        <label>Status</label>
        <input file icon="network-wireless"></input>
	    <action type="launch">IWCONFIG</action>
      </button>
      <button>
        <input file icon="exit"></input>
        <action type="exit">Exit</action>
      </button>
    </hbox>
  
  </vbox>
</window>
'
 
gtkdialog --program=WIFI_DIALOG

exit 0
