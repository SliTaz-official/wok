# SliTaz package receipt.

PACKAGE="ipxe"
VERSION="1.0.0-20121001"
GIT_TAG="d23db2848813a9d872e1d71272e7f41df7d0d01c"
CATEGORY="system-tools"
SHORT_DESC="Open source network boot firmware."
MAINTAINER="pascal.bellard@slitaz.org"
WEB_SITE="http://ipxe.org/"
TARBALL="$PACKAGE-$VERSION.tar.bz2"
WGET_URL="https://git.ipxe.org/ipxe.git/snapshot/$GIT_TAG.tar.bz2"

DEPENDS=""
BUILD_DEPENDS="perl wget"

# Rules to configure and make the package.
compile_rules()
{
	cd $src/src
	make bin/undionly.kpxe bin/ipxe.lkrn
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir $fs/boot
	cp -a $src/src/bin/ipxe.lkrn $fs/boot/ipxe
	cat > $fs/boot/ipxe.cmd <<EOT
#!ipxe

dhcp

:menu
menu SliTaz net boot menu
item lan	Your PXE boot
item web	SliTaz WEB boot
item rolling	SliTaz development version
item config	iPXE configuration
item exit	iPXE command line
choose --default web --timeout 3000 target && goto ${target}

:exit
help
shell
goto menu

:web
chain http://mirror.slitaz.org/pxe/pxelinux.0
chain http://mirror.switch.ch/ftp/mirror/pxe/pxelinux.0
chain http://download.tuxfamily.org/slitaz/pxe/pxelinux.0
goto menu

:lan
autoboot
goto menu

:rolling
sanboot http://mirror.slitaz.org/iso/rolling/slitaz-rolling.iso
goto menu

:config
config
goto menu
EOT
}
