# SliTaz package receipt.

PACKAGE="aufs"
VERSION="20081206"
CATEGORY="base-system"
SHORT_DESC="Stackable unification FileSystem utilities."
MAINTAINER="pascal.bellard@slitaz.org"
WEB_SITE="http://$PACKAGE.sourceforge.net/"
DEPENDS="aufs-module"
BUILD_DEPENDS="cvs lzma"

# Rules to configure and make the package.
compile_rules()
{
	cvsroot=anonymous@$PACKAGE.cvs.sourceforge.net:/cvsroot
	if [ ! -d $src ]; then
		cvs -z3 -d:pserver:$cvsroot/$PACKAGE co -D$VERSION $PACKAGE
		mv $PACKAGE $src
	fi
	local kver
	if [ ! -d ../linux/taz ]; then
		tazwok cook linux
	fi
	kver=$(grep "kernel version" ../linux/linux-*/.config)
	kver=${kver##* }
	cd $src
	ln -s $(cd ../../linux/linux-$kver* ; pwd)/include/linux/* include/linux
	make KDIR=$(cd ../../linux/linux-$kver* ; pwd) -f local.mk
	mkdir -p _pkg/lib/modules/$kver-slitaz/kernel/fs/aufs/ _pkg/sbin
	mkdir -p _pkg/etc/default
	lzma e $(readlink aufs.ko) \
        	_pkg/lib/modules/$kver-slitaz/kernel/fs/aufs/aufs.ko.gz
	cp util/etc_default_aufs _pkg/etc/default/aufs
	chmod 644 _pkg/etc/default/aufs
	echo FLUSH=ALL > _pkg/etc/default/auplink
	for i in umount.aufs mount.aufs auplink aulchown aufind.sh auchk; do
		cp $(readlink $i) _pkg/sbin
		chmod 500 _pkg/sbin/$i
	done
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	cp -a $_pkg/sbin $_pkg/etc $fs
}

