# SliTaz package receipt.

PACKAGE="slib"
VERSION="3b3"
CATEGORY="office"
SHORT_DESC="portable library for the programming language Scheme"
MAINTAINER="domcox@slitaz.org"
LICENSE="Public Domain"
WEB_SITE="http://people.csail.mit.edu/jaffer/SLIB"
TARBALL="$PACKAGE-$VERSION.tar.gz"
WGET_URL="http://groups.csail.mit.edu/mac/ftpdir/scm/$TARBALL"

DEPENDS="guile"
BUILD_DEPENDS="guile texinfo"

# Rules to configure and make the package.
compile_rules()
{
	./configure  \
		--prefix=/usr &&
	sed -i 's/SCHEME = scm/SCHEME = guile/' Makefile
	echo "# install-script"
	make install-script
	echo "# install files"
	mkdir -p $install/usr/share/slib
	install -m644 *.scm *.init *.xyz *.txt *.dat *.ps $install/usr/share/slib
	echo "# creating SLIB initialization file"
	mkdir -p $install/usr/share/guile/1.8
	ln -s $install/usr/share/slib $install/usr/share/guile/site
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	cp -a $install/* $fs
}

post_install()
{
	# add path to initialization file
	sed -i s'#(load-from.*#(load-from-path "/usr/share/slib/guile.init")#' \
		/usr/share/guile/1.8/ice-9/slib.scm
	printf "Creating catalog"
	guile -c "((use-modules (ice-9 slib))(require 'new-catalog)(quit))"
	status
}

post_remove()
{
	rm -f /usr/share/guile/1.8/slibcat
}
