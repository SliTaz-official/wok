# SliTaz package receipt.

PACKAGE="pgrouting"
VERSION="2.5.2"
CATEGORY="misc"
SHORT_DESC="provide geospatial routing for PostGIS / PostgreSQL."
MAINTAINER="pascal.bellard@slitaz.org"
LICENSE="GPL2"
TARBALL="$PACKAGE-$VERSION.tar.gz"
WEB_SITE="http://pgrouting.org/"
WGET_URL="https://codeload.github.com/pgRouting/pgrouting/tar.gz/v$VERSION"

DEPENDS="gcc-lib-base cgal gmp libboost-thread libboost-system \
libboost-chrono libboost-date-time"
BUILD_DEPENDS="wget cmake postgresql-dev libboost-dev cgal-dev gmp-dev \
mpfr-dev libboost-graph-dev libboost-thread-dev libboost-tr1-dev"

# Rules to configure and make the package.
compile_rules()
{
	sed -i 's/INT2ARRAYOID/1005/' src/common/src/get_check_data.c
	mkdir build
	cd build
	cmake -DWITH_DD=ON ..
	make
	make install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	mkdir -p $fs/usr
	cp -a $install/usr/* $fs/usr
	sed -i 's|\$libdir|/usr/lib/postgresql|' \
		$fs/usr/share/postgresql/extension/*.sql
}

post_install_example()
{
	database=test
	chroot "$1/" createdb -U postgres -h localhost $database
	chroot "$1/" psql -U postgres -U postgres $database <<EOT
create extension pgrouting;
\q
EOT
	sed 1d $1/usr/share/postgresql/extension/pgrouting--$VERSION.sql |
	chroot "$1/" psql -U postgres $database
}
