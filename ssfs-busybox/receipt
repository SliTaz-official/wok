# SliTaz package receipt.

PACKAGE="ssfs-busybox"
VERSION="1.18.4"
CATEGORY="base-system"
SHORT_DESC="Busybox for Ssfs virtual disk minimal chroot."
MAINTAINER="pankso@slitaz.org"
SOURCE="busybox"
TARBALL="$SOURCE-$VERSION.tar.bz2"
WEB_SITE="http://www.busybox.net/"
WGET_URL="http://www.busybox.net/downloads/$TARBALL"

#
# NOTE: We Install files in Ssfs data directory to always have have ready to
# create chroot on the server and provide an easy way to update the vdisk.
# We dont do a static build, we need some shared lib in the chroot anyway.
# Busybox is configured to not use /usr and with a minimal set of applets.
#

# Rules to configure and make the package.
compile_rules()
{
	rootfs=$DESTDIR/usr/share/ssfs/rootfs
	cd $src && cp $stuff/*.config .config
	make oldconfig && make busybox &&
	make CONFIG_PREFIX=$rootfs install
}

# Rules to gen a SliTaz package suitable for Tazpkg.
genpkg_rules()
{
	rootfs=$fs/usr/share/ssfs/rootfs
	mkdir -p $rootfs/etc
	cp -a $install/* $fs
	cp $stuff/busybox.conf $rootfs/etc
	chown -R 0.0 $rootfs/etc
	chmod 0600 $rootfs/etc/busybox.conf
	chmod 4755 $rootfs/bin/busybox
}
